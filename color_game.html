<!doctype html>

<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Color Guesser Game</title>
  <style>
    :root{
      --bg-light:#f3f4f6;--card-light:#fff;--text-light:#111;
      --bg-dark:#1f1f22;--card-dark:#2b2c2e;--text-dark:#f5f5f5;
      --accent:#6b46c1;
    }
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans',Helvetica,Arial}
    body{display:flex;align-items:center;justify-content:center;background:var(--bg-light);color:var(--text-light);transition:background .3s,color .3s;}
    .dark{background:var(--bg-dark);color:var(--text-dark)}
    .container{width:min(420px,94vw);background:var(--card-light);border-radius:12px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,0.35);transition:background .3s}
    .dark .container{background:var(--card-dark)}
    h1{font-size:18px;margin:0 0 6px 0;text-align:center}
    .meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;font-weight:600}
    .swatches{display:flex;gap:12px;align-items:center;justify-content:center;margin-bottom:8px}
    .swatch{width:60px;height:60px;border-radius:8px;border:3px solid rgba(0,0,0,0.06)}
    .wheel-wrap{display:flex;justify-content:center;padding:8px}
    canvas#wheel{width:260px;height:260px;border-radius:50%;touch-action:none}
    .controls{display:flex;gap:8px;justify-content:center;margin-top:8px;flex-wrap:wrap}
    button{background:var(--accent);color:white;border:0;padding:10px 14px;border-radius:8px;font-weight:600;cursor:pointer}
    button.secondary{background:#eee;color:#111}
    .dark button.secondary{background:#555;color:#fff}
    footer{font-size:12px;opacity:.7;text-align:center;margin-top:10px}
    .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.45)}
    .dialog{background:white;color:#111;padding:18px;border-radius:12px;min-width:280px;text-align:center}
    .dark .dialog{background:#2b2c2e;color:#f5f5f5}
    .config-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.4);display:flex;align-items:center;justify-content:center;transition:opacity .3s,transform .3s;z-index:10}
    .config-card{background:var(--card-light);color:var(--text-light);padding:18px;border-radius:12px;min-width:280px;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,0.5);transform:translateY(0);transition:transform .3s}
    .dark .config-card{background:var(--card-dark);color:var(--text-dark)}
    .hidden{opacity:0;pointer-events:none;transform:translateY(-10px)}
    #settingsBtn{position:absolute;top:12px;right:12px;font-size:20px;background:transparent;border:none;cursor:pointer;color:inherit}
  </style>
</head>
<body>
  <button id="settingsBtn" title="設定">⚙️</button>
  <div class="container" id="gameScreen">
    <h1>Color Guesser — 顏色辨識遊戲</h1>
    <div class="meta">
      <div class="round">Round <span id="roundNum">1</span> / <span id="totalRounds">4</span></div>
      <div class="score">Score: <span id="totalScore">0</span> | High: <span id="highScore">0</span></div>
    </div>
    <div class="swatches">
      <div><div class="swatch" id="targetSwatch"></div><div style="text-align:center;font-size:12px">Target</div></div>
      <div><div class="swatch" id="guessSwatch"></div><div style="text-align:center;font-size:12px">Your Guess</div></div>
    </div>
    <div class="wheel-wrap"><canvas id="wheel" width="520" height="520"></canvas></div>
    <div class="controls">
      <button id="skipBtn" class="secondary">跳過</button>
      <button id="resetBtn" class="secondary">重置</button>
    </div>
    <footer>點擊色盤以選擇顏色，將立即判分。</footer>
  </div>  <div class="config-overlay" id="configOverlay">
    <div class="config-card">
      <h2>設定</h2>
      <label>回合數：<button id="minusRound">−</button> <span id="roundCount">4</span> <button id="plusRound">＋</button></label><br><br>
      <label>主題風格：
        <select id="themeSelect">
          <option value="light">亮色</option>
          <option value="dark">暗色</option>
        </select>
      </label><br><br>
      <button id="startBtn">開始遊戲</button>
    </div>
  </div>  <div class="overlay" id="overlay"><div class="dialog" id="dialog"></div></div><script>
let TOTAL_ROUNDS=4,currentRound=1,totalScore=0,targetRGB=[0,0,0],guessRGB=[255,255,255],roundScores=[],roundColors=[],theme=localStorage.getItem('theme')||'light';
let highScores=JSON.parse(localStorage.getItem('highScores')||'{}');

const body=document.body;const configOverlay=document.getElementById('configOverlay');const wheel=document.getElementById('wheel');const ctx=wheel.getContext('2d');const targetSwatch=document.getElementById('targetSwatch');const guessSwatch=document.getElementById('guessSwatch');const totalScoreEl=document.getElementById('totalScore');const roundNumEl=document.getElementById('roundNum');const totalRoundsEl=document.getElementById('totalRounds');const overlay=document.getElementById('overlay');const dialog=document.getElementById('dialog');const highScoreEl=document.getElementById('highScore');

function updateHighScoreDisplay(){const key=TOTAL_ROUNDS;highScoreEl.textContent=highScores[key]||0;}
updateHighScoreDisplay();

if(theme==='dark')body.classList.add('dark');document.getElementById('themeSelect').value=theme;

document.getElementById('themeSelect').onchange=(e)=>{theme=e.target.value;body.classList.toggle('dark',theme==='dark');localStorage.setItem('theme',theme);};
document.getElementById('minusRound').onclick=()=>{if(TOTAL_ROUNDS>1){TOTAL_ROUNDS--;document.getElementById('roundCount').textContent=TOTAL_ROUNDS;delete highScores[TOTAL_ROUNDS];localStorage.setItem('highScores',JSON.stringify(highScores));updateHighScoreDisplay();}};
document.getElementById('plusRound').onclick=()=>{if(TOTAL_ROUNDS<10){TOTAL_ROUNDS++;document.getElementById('roundCount').textContent=TOTAL_ROUNDS;delete highScores[TOTAL_ROUNDS];localStorage.setItem('highScores',JSON.stringify(highScores));updateHighScoreDisplay();}};

document.getElementById('startBtn').onclick=()=>{configOverlay.classList.add('hidden');startGame();};
document.getElementById('settingsBtn').onclick=()=>configOverlay.classList.remove('hidden');
document.getElementById('resetBtn').onclick=()=>location.reload();
document.getElementById('skipBtn').onclick=()=>finalizeRound(0);

function startGame(){totalRoundsEl.textContent=TOTAL_ROUNDS;drawWheel();setTarget();}

function hsv2rgb(h,s,v){const c=v*s;const hh=h/60;const x=c*(1-Math.abs(hh%2-1));let r=0,g=0,b=0;if(hh<1){r=c;g=x;}else if(hh<2){r=x;g=c;}else if(hh<3){g=c;b=x;}else if(hh<4){g=x;b=c;}else if(hh<5){r=x;b=c;}else{r=c;b=x;}const m=v-c;return[r+m,g+m,b+m];}
function drawWheel(){const size=wheel.width;const img=ctx.createImageData(size,size);const data=img.data;const cx=size/2,cy=size/2,r=size/2;for(let y=0;y<size;y++){for(let x=0;x<size;x++){const dx=x-cx,dy=y-cy,d=Math.sqrt(dx*dx+dy*dy),idx=(y*size+x)*4;if(d>r){data[idx]=255;data[idx+1]=255;data[idx+2]=255;data[idx+3]=255;continue;}const angle=Math.atan2(dy,dx);let h=(angle/(2*Math.PI))*360;if(h<0)h+=360;const s=d/r;const v=1;const [R,G,B]=hsv2rgb(h,s,v);data[idx]=R*255;data[idx+1]=G*255;data[idx+2]=B*255;data[idx+3]=255;}}ctx.putImageData(img,0,0);}
function randomTarget(){const h=Math.random()*360;const s=0.3+Math.random()*0.6;const v=0.85;return hsv2rgb(h,s,v).map(v=>Math.round(v*255));}
function setTarget(){targetRGB=randomTarget();targetSwatch.style.background=`rgb(${targetRGB.join(',')})`;guessSwatch.style.background='#fff';}
function colorDist(a,b){const d=a[0]-b[0],e=a[1]-b[1],f=a[2]-b[2];return Math.sqrt(d*d+e*e+f*f);}function calcPoints(dist){return Math.round(Math.max(0,200-(dist/441)*200));}
function pickColor(e){const rect=wheel.getBoundingClientRect();const scaleX=wheel.width/rect.width;const scaleY=wheel.height/rect.height;const x=(e.touches?e.touches[0].clientX:e.clientX)-rect.left;const y=(e.touches?e.touches[0].clientY:e.clientY)-rect.top;const px=ctx.getImageData(x*scaleX,y*scaleY,1,1).data;const rgb=[px[0],px[1],px[2]];if(rgb[0]===255&&rgb[1]===255&&rgb[2]===255)return;guessRGB=rgb;guessSwatch.style.background=`rgb(${rgb.join(',')})`;const dist=colorDist(targetRGB,guessRGB);const pts=calcPoints(dist);showRoundResult(pts);}

wheel.addEventListener('click',pickColor);
function showRoundResult(points){dialog.innerHTML=`<div style='display:flex;gap:10px;justify-content:center;margin-bottom:8px'><div style='width:48px;height:48px;border-radius:6px;background:rgb(${targetRGB.join(',')})'></div><div style='width:48px;height:48px;border-radius:6px;background:rgb(${guessRGB.join(',')})'></div></div><strong>+${points} 分</strong>`;overlay.style.display='flex';setTimeout(()=>{overlay.style.display='none';finalizeRound(points);},1500);}
function finalizeRound(points){roundScores.push(points);roundColors.push({target:targetRGB,guess:guessRGB});totalScore+=points;totalScoreEl.textContent=totalScore;if(currentRound<TOTAL_ROUNDS){currentRound++;roundNumEl.textContent=currentRound;setTarget();}else{showResults();}}
function showResults(){const key=TOTAL_ROUNDS;if(!highScores[key]||totalScore>highScores[key]){highScores[key]=totalScore;localStorage.setItem('highScores',JSON.stringify(highScores));}let html=`<h3>遊戲結束！總分：${totalScore}</h3><div style='text-align:left;font-size:13px;margin-top:10px'>`;roundScores.forEach((p,i)=>{const {target,guess}=roundColors[i];html+=`<div style='display:flex;align-items:center;gap:6px;margin-bottom:6px'><div style='width:24px;height:24px;border-radius:4px;background:rgb(${target.join(',')})'></div><div style='width:24px;height:24px;border-radius:4px;background:rgb(${guess.join(',')})'></div><span>Round ${i+1}: ${p}分</span></div>`});html+=`</div><button style='margin-top:10px' onclick='location.reload()'>再玩一次</button>`;dialog.innerHTML=html;overlay.style.display='flex';}
</script></body>
</html>